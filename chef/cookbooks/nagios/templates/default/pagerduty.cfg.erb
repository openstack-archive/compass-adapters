# Pagerduty definitions
#
# Autogenerated by Chef.

define command {
       command_name     notify-service-by-pagerduty
       command_line     <%= ::File.join(node['nagios']['plugin_dir'], "notify_pagerduty.pl") %> enqueue -f pd_nagios_object=service
}

define command {
       command_name     notify-host-by-pagerduty
       command_line     <%= ::File.join(node['nagios']['plugin_dir'], "notify_pagerduty.pl") %> enqueue -f pd_nagios_object=host
}

<% unless node['nagios']['pagerduty']['key'].nil? || node['nagios']['pagerduty']['key'].empty? -%>
define contact {
       contact_name                             pagerduty
       alias                                    PagerDuty Pseudo-Contact
       service_notification_period              24x7
       host_notification_period                 24x7
       service_notification_options             <%= node["nagios"]["pagerduty"]["service_notification_options"] %>
       host_notification_options                <%= node["nagios"]["pagerduty"]["host_notification_options"] %>
       service_notification_commands            notify-service-by-pagerduty
       host_notification_commands               notify-host-by-pagerduty
       pager                                    <%= node["nagios"]["pagerduty"]["key"] %>
}
<% end -%>

<% @contacts.each do |contact| -%>
define contact {
       contact_name                             <%= contact['contact'] || contact['id'] %>
       alias                                    PagerDuty Pseudo-Contact <%= contact['contact'] || contact['id'] %>
       service_notification_period              <%= contact['service_notification_period']  || "24x7" %>
       host_notification_period                 <%= contact['host_notification_period']     || "24x7" %>
       service_notification_options             <%= contact['service_notification_options'] || "w,u,c,r" %>
       host_notification_options                <%= contact['host_notification_options']    || "d,r" %>
       service_notification_commands            notify-service-by-pagerduty
       host_notification_commands               notify-host-by-pagerduty
       pager                                    <%= contact['key'] || contact['pagerduty_key'] %>
}

<% end -%>
